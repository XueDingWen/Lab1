<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>lab1.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">lab1 (2016-11-17 16:11:52)</a> &gt; <a href="../../index.html" class="el_group">experiment1</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.source.html" class="el_package">experiment1</a> &gt; <span class="el_source">lab1.java</span></div><h1>lab1.java</h1><pre class="source lang-java linenums">package experiment1;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
<span class="fc" id="L10">class IntegerString </span>
{	int number;
	String stringvarible;}//构造一个类，包括系数number和变量stringvariable

<span class="nc" id="L14">public class lab1</span>
{	public static String cmd;//cmd表示指令
	public static String exp;//exp表示表达式
	public static String expression;//expression也表示表达式
	
	public static void main(String[] args) throws IOException 
	{	/*主函数执行读入表达式和指令的功能*/
<span class="fc" id="L21">		BufferedReader buff = new BufferedReader(new InputStreamReader(System.in));</span>
<span class="fc" id="L22">		while(true)</span>
<span class="fc" id="L23">		{	System.out.println(&quot;请输入表达式：&quot;);</span>
<span class="fc" id="L24">			exp = buff.readLine();</span>
<span class="pc bpc" id="L25" title="1 of 2 branches missed.">			if(!Expression(exp))</span>
<span class="nc" id="L26">				continue;</span>
<span class="fc" id="L27">			System.out.println(&quot;请输入命令：&quot;);</span>
<span class="fc" id="L28">			cmd = buff.readLine();</span>
<span class="fc" id="L29">			validate(cmd);}}</span>
	
	public static boolean Expression(String str) throws IOException/*表达式检查*/
<span class="fc" id="L32">	{	String F=&quot;0123456789QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm&quot;;</span>
<span class="fc" id="L33">		String Ch=&quot;QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm&quot;;</span>
<span class="fc" id="L34">		String Cal=&quot;+*&quot;;</span>
		
<span class="pc bpc" id="L36" title="1 of 2 branches missed.">		if(F.indexOf(str.charAt(0))==-1)</span>
<span class="nc" id="L37">		{	System.out.println(&quot;首字符非法&quot;);</span>
<span class="nc" id="L38">			return false;}</span>
		
<span class="fc bfc" id="L40" title="All 2 branches covered.">		for(int i=1;i&lt;str.length();i++)</span>
<span class="pc bpc" id="L41" title="1 of 4 branches missed.">		{	if( (F.indexOf(str.charAt(i))==-1) &amp;&amp; (Cal.indexOf(str.charAt(i))==-1) )</span>
<span class="nc" id="L42">			{	System.out.print(&quot;含有非法字符：&quot;);</span>
<span class="nc" id="L43">				System.out.println(str.charAt(i));</span>
<span class="nc" id="L44">				return false;}</span>
		
<span class="pc bpc" id="L46" title="1 of 4 branches missed.">			if( (Ch.indexOf(str.charAt(i))!=-1) &amp;&amp; (Ch.indexOf(str.charAt(i-1))!=-1))</span>
<span class="nc" id="L47">			{	System.out.println(&quot;含有多字母变量&quot;);</span>
<span class="nc" id="L48">				return false;}</span>
		
<span class="pc bpc" id="L50" title="1 of 4 branches missed.">			if( (Cal.indexOf(str.charAt(i))!=-1) &amp;&amp; (Cal.indexOf(str.charAt(i-1))!=-1))</span>
<span class="nc" id="L51">			{	System.out.println(&quot;运算符相连&quot;);</span>
<span class="nc" id="L52">				return false;}}</span>
		
<span class="fc" id="L54">		return true;}</span>
	
	public static void validate(String string) throws IOException 
<span class="pc bpc" id="L57" title="1 of 2 branches missed.">	{	if (string.startsWith(&quot;!simplify&quot;))//化简指令</span>
<span class="fc" id="L58">		{	String varibles[] = string.substring(10).split(&quot; &quot;);</span>
<span class="pc bpc" id="L59" title="1 of 2 branches missed.">			if (varibles[0].isEmpty())/*判断是否没有变量赋值，如果没有给变量赋值，就直接输出该串即可*/</span>
<span class="nc" id="L60">			{	System.out.println(exp);</span>
<span class="nc" id="L61">				return;}</span>
			
<span class="fc bfc" id="L63" title="All 2 branches covered.">			for (String string1 : varibles) </span>
<span class="fc" id="L64">			{	String varible4[] = string1.split(&quot;=&quot;);</span>
<span class="pc bpc" id="L65" title="1 of 2 branches missed.">				if (exp.indexOf(varible4[0]) == -1) </span>
				{	/*这段代码看原表达式是否包含带入的变量*/
<span class="nc" id="L67">					System.out.println(&quot;Invaild simplification!&quot;);</span>
<span class="nc" id="L68">					return;}</span>
				
				else/*这段是看赋值时等号右边是否是数字如果不是数字，那么赋值显然无效*/
				{	try
<span class="fc" id="L72">					{	Integer.parseInt(varible4[1]);}</span>
<span class="nc" id="L73">					catch(NumberFormatException ex)</span>
<span class="nc" id="L74">					{	System.out.println(&quot;Invaild simplification!&quot;);</span>
<span class="nc" id="L75">						return;}}}</span>
<span class="fc" id="L76">			expression = exp;</span>
<span class="fc" id="L77">			String[] variable = cmd.substring(10).split(&quot; &quot;);</span>
<span class="fc bfc" id="L78" title="All 2 branches covered.">			for (String element : variable) </span>
			{	/*这段代码实现的功能是将赋值的值替换给原表达式中的变量*/
<span class="fc" id="L80">				String[] replacement = element.split(&quot;=&quot;);</span>
<span class="fc" id="L81">				expression = expression.replaceAll(replacement[0], replacement[1]);}</span>
<span class="fc" id="L82">			simplify();return;}</span>
		
<span class="nc bnc" id="L84" title="All 2 branches missed.">		else if (string.startsWith(&quot;!d/d &quot;))</span>
<span class="nc" id="L85">		{	String varible = string.substring(5);</span>
<span class="nc bnc" id="L86" title="All 2 branches missed.">			if (exp.indexOf(varible) == -1) </span>
			{	/*显然这段代码用来判断求导变量是否有效，同样，如果表达式是关于x的，而求导变量为y，此时判断为无效*/
<span class="nc" id="L88">				System.out.println(&quot;Inavaild derivative!&quot;);</span>
<span class="nc" id="L89">				return;}</span>
			else
<span class="nc" id="L91">			{	derivative();return;}}}</span>

	public static void derivative() throws IOException 
<span class="nc" id="L94">	{	String varibles2 = cmd.substring(5);//这条指令找到求导变量</span>
<span class="nc" id="L95">		String stringarray2[] = exp.split(&quot;\\+&quot;);//以加号分割</span>
<span class="nc" id="L96">		StringBuilder stringbuff3 = new StringBuilder();</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">		for (String element : stringarray2) </span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">		{	if (element.contains(varibles2)) </span>
			{	int constant;
<span class="nc" id="L100">				constant = 0;</span>
<span class="nc" id="L101">				String elements[] = element.split(&quot;\\*&quot;);</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">				for (String varible : elements) </span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">				{	if (varible.equals(varibles2))//变量出现一次，constant就累加1</span>
<span class="nc" id="L104">						constant++;}//最终累加得到x的个数</span>
<span class="nc" id="L105">				element = element.replaceFirst(varibles2, Integer.toString(constant));</span>
<span class="nc" id="L106">			stringbuff3.append(element);//把处理后的式子加入StringBuilder</span>
<span class="nc" id="L107">			stringbuff3.append(&quot;+&quot;);}}</span>
<span class="nc" id="L108">		int len1 = stringbuff3.length();</span>
<span class="nc" id="L109">		stringbuff3.deleteCharAt(len1 - 1);//当然，在这里也要去掉最后一个加号</span>
<span class="nc" id="L110">		expression = stringbuff3.toString();</span>
<span class="nc" id="L111">		simplify();}//调用化简函数</span>
	
	public static String simplify()  throws IOException
<span class="fc" id="L114">	{	ArrayList&lt;IntegerString&gt; arraylist = new ArrayList&lt;IntegerString&gt;();</span>
<span class="fc" id="L115">		Map&lt;String, Integer&gt; map = new HashMap&lt;String, Integer&gt;(); //map用来合并同类项</span>
<span class="fc" id="L116">		StringBuilder stringbuff = new StringBuilder(); //stringbuilder用来对字符串进行动态操作</span>
<span class="fc" id="L117">		String[] stringarray = expression.split(&quot;\\+&quot;);  //首先先以加号分割</span>
		
<span class="fc bfc" id="L119" title="All 2 branches covered.">		for (String str : stringarray)//对每个子式进行处理</span>
<span class="fc" id="L120">		{ 	int constant = 1;</span>
			int number1;
<span class="fc" id="L122">			List&lt;String&gt; varibles = new ArrayList&lt;String&gt;();/*变量*/</span>
<span class="fc" id="L123">			String[] stringarray1 = str.split(&quot;\\*&quot;);/*按乘号分割*/</span>
<span class="fc" id="L124">			IntegerString integerstring1 = new IntegerString();</span>
<span class="fc" id="L125">			StringBuilder stringbuff1 = new StringBuilder();</span>
<span class="fc bfc" id="L126" title="All 2 branches covered.">			for (String element : stringarray1) </span>
<span class="fc bfc" id="L127" title="All 2 branches covered.">			{	/*try*/if(&quot;0123456789&quot;.indexOf(element.charAt(0))!=-1)</span>
				{	/*如果是数字，就乘起来*/
<span class="fc" id="L129">					number1 = Integer.parseInt(element);</span>
<span class="fc" id="L130">					constant *= number1;} </span>
				else /*(Exception e) */
<span class="fc" id="L132">				{	varibles.add(element);}}//如果是变量，就加到字符串数组里面</span>
			
<span class="fc bfc" id="L134" title="All 2 branches covered.">			for (String var : varibles)</span>
<span class="fc" id="L135">			{	stringbuff1.append(var);}//将字符串数组中的变量加入StringBuilder</span>
			
<span class="fc" id="L137">			integerstring1.stringvarible = stringbuff1.toString();//每一个式子的变量加入类中</span>
<span class="fc" id="L138">			integerstring1.number = constant; //每个式子的数值加入类的数值中</span>
<span class="fc" id="L139">			arraylist.add(integerstring1);}</span>
		
<span class="fc bfc" id="L141" title="All 2 branches covered.">		for (IntegerString intstr : arraylist)//合并同类项</span>
<span class="fc" id="L142">		{ 	String key = intstr.stringvarible;/*变量*/</span>
<span class="fc" id="L143">			int value = intstr.number;/*系数*/</span>
<span class="fc bfc" id="L144" title="All 2 branches covered.">			if (map.containsKey(key)==false) </span>
<span class="fc" id="L145">			{	map.put(key, value);}//如果变量不同，直接将键值对加入map </span>
<span class="pc bpc" id="L146" title="1 of 2 branches missed.">			else if (map.containsKey(key)==true) </span>
<span class="fc" id="L147">			{	value += map.get(key); //如果变量相同，那么就将系数累加之后再加入map</span>
<span class="fc" id="L148">				map.put(key, value);}}</span>
		
<span class="fc bfc" id="L150" title="All 2 branches covered.">		for (String keyinset : map.keySet())/*将每一对键值对加入StringBuilder中,动态处理字符串*/</span>
<span class="fc" id="L151">		{	stringbuff.append(map.get(keyinset).toString() + keyinset + '+');}</span>
		
<span class="fc" id="L153">		int len = stringbuff.length();</span>
<span class="fc" id="L154">		stringbuff.deleteCharAt(len - 1); //去掉最后一个加号</span>
<span class="fc" id="L155">		System.out.println(stringbuff.toString());</span>
<span class="fc" id="L156">		return stringbuff.toString();}}</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span>lab1 (2016-11-17 16:11:52)</div></body></html>